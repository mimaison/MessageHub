---

copyright:
  years: 2015, 2017
lastupdated: "2017-03-10"

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}

# MQ ブリッジ
{: #mq_bridge}

MQ ブリッジを使用すると、{{site.data.keyword.IBM_notm}} MQ キューから {{site.data.keyword.messagehub}} Kafka トピックへメッセージ・データを転送できます。MQ ブリッジによって、企業内で生成された {{site.data.keyword.IBM_notm}} MQ メッセージ・データに対してクラウド・スタイルのワークロード (例えばデータ分析) を効率的に実行できるようになります。
{:shortdesc}

MQ ブリッジは、MQ クライアントとして {{site.data.keyword.IBM_notm}} MQ キュー・マネージャーに接続し、MQ キューから MQ メッセージ・データをコンシュームします。ブリッジは、各 MQ メッセージを Kafka レコードに変換して、メッセージを {{site.data.keyword.messagehub}} Kafka トピックに送信します。

## サポートされる {{site.data.keyword.IBM_notm}} MQ のバージョン
{: #mq_support}

このブリッジと共に使用できる {{site.data.keyword.IBM_notm}} MQ のバージョンは次のとおりです。

* {{site.data.keyword.IBM_notm}} MQ バージョン 8.0 以降

## MQ ブリッジの保護
{: #mq_bridge_security}

ユーザー ID およびパスワードを使用して {{site.data.keyword.IBM_notm}} MQ で認証するように MQ ブリッジを構成できます。MQ ブリッジのインスタンスと関連付けられた ID にのみ以下の許可を付与することをお勧めします。

* CONNECT 権限。MQ ブリッジは、MQ キュー・マネージャーに接続可能でなければなりません。
* MQ ブリッジ構成でコンシューム元となっているキューに対する GET 権限。

## メッセージ信頼性および順序付け
{: #mq_bridge_reliability}

MQ ブリッジは、転送するメッセージ・データに対して at-least-once レベルの信頼性を実装します。これは、ブリッジがメッセージ・データを失うことはないが、場合によっては、MQ メッセージのシーケンスに対して Kafka レコードのシーケンスを重複して生成する可能性があることを意味します。一般的には、イベントによってブリッジでのメッセージ・データの処理が中断された場合に重複が発生します。以下に例を示します。

* MQ キュー・マネージャーの再始動
* MQ キュー・マネージャーとブリッジとの間のネットワークの中断
* Kafka トピックのパーティション割り当ての再バランシング
* ブリッジと Kafka との間のネットワークの中断

MQ ブリッジは、MQ からのメッセージを確実に転送できるように、メッセージの読み取り元の MQ キューへの排他的アクセスを要求します。この排他的アクセスにより、ブリッジが使用している間は MQ キューから他のアプリケーションがメッセージを受信できなくなります。他のアプリケーションがキューから既にメッセージを受信中の場合は、それらのアプリケーションが終了するまで MQ ブリッジが開始できないことがあります。

一般に、MQ ブリッジは、{{site.data.keyword.IBM_notm}} MQ から受信した順序で MQ メッセージを Kafka に転送します。ただし、場合によっては Kafka トピック内で MQ メッセージ・データが重複することがあります (理由は前述のとおり)。この重複の結果として、MQ メッセージの順序と、対応するレコードが Kafka に保管される順序が異なることがあります。

## Kafka パーティション割り当て
{: #mq_bridge_partition}

MQ ブリッジでは、Kafka トピック・パーティションへの {{site.data.keyword.IBM_notm}} MQ メッセージ・データの割り当てを制御するためのオプションがサポートされています。特定のパーティション内でのメッセージの順序付けは、メッセージ・データ順序付けに選択されたオプションに基づきます ([メッセージ信頼性および順序付け](#mq_bridge_reliability)を参照してください)。サポートされる値は次のとおりです。
<dl><dt>Default</dt>
<dd>Kafka のデフォルトのパーティション割り当てが使用されます。これは、MQ メッセージからのデータが Kafka トピック内のパーティションに均等に配布されることを意味します。</dd>
<dt>CorrelationId</dt>
<dd>同じ相関 ID を持つ MQ メッセージは同じ Kafka パーティションに割り当てられます。</dd>
<dt>GroupId</dt>
<dd>同じグループ ID を持つ MQ メッセージは同じ Kafka パーティションに割り当てられます。
</dd>
</dl>

## メッセージ・サイズ制限
{: #mq_message}

大きすぎて {{site.data.keyword.messagehub}} Kafka レコードに収まらないメッセージを保管するように {{site.data.keyword.IBM_notm}} MQ を構成することができます。Kafka レコードの最大サイズは 1,000,000 バイトですが、MQ 相関 ID または MQ グループ ID に基づいて Kafka パーティション割り当てを実行するようにブリッジが構成されている場合は、この容量の一部が使用されます。950 キロバイト以下のメッセージを MQ ブリッジを使用して送信することをお勧めします。

MQ ブリッジは、Kafka へ転送するには大きすぎるメッセージが検出された場合、そのメッセージを破棄し、Kibana ダッシュボードにログ項目を書き込みます。ブリッジがメッセージを受信する元の MQ キューの MAXMSGL 属性を設定して、MQ ブリッジを使用して転送できないメッセージを MQ アプリケーションがキューに送信しないようにすることを検討してください。
